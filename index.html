<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Program Editor</title>

    <!-- Bootstrap -->
    <!-- <link rel="stylesheet" href="/libs/css/bootstrap/dist/css/bootstrap.min.css" /> -->
   <link href="styles/bootstrap.flatly.css" rel="stylesheet" />

    <!-- jQuery daterangepicker, jQuery timepicker, & Dragula -->
    <link href="./dependencies/jquery-daterange-picker/daterangepicker.min.css" rel="stylesheet" />
    <link href="./dependencies/jquery-timepicker/jquery.timepicker.css" rel="stylesheet" />
    <link href="./dependencies/dragula/dragula.css" rel="stylesheet" />

    <!-- Styling: Custom -->
    <link href="./styles/main.css" rel="stylesheet" />
    <link href="/libs/fonts/raleway-regular.css" rel="stylesheet"/>
    <link href="/libs/fonts/open-sans-condensed.css" rel="stylesheet"/>
  </head>
  <body>
    <nav class="navbar navbar-expand navbar-custom" id="topNav" role="navigation">
      <span class="navbar-brand" id="navBrand">Program Creator</span>
      <ul class="navbar-nav ml-auto" id="topNavList">
        <li class="nav-item">
          <span class="navbar-text" id="save_status"></span>
        </li>
        <li role="button" class="nav-item dropdown">
          <!-- NOTE/TODO: turns out dropdowns don't have to be anchors (as they did in Bootstrap 3.3); they can be buttons. which I tested and works beautifully with added .btn -->
          <a class="nav-link dropdown-toggle" href="#" id="fileDD" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            File
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="fileDD">
            <a id="openMenu" onclick="javascript:location.reload()" class="dropdown-item">
              Open
            </a>
            <a id="editMetadataMenu" onclick="showEditMetadata();" class="dropdown-item">
              Edit dates and name
            </a>
            <a id="saveMenu" onclick="saveProgram();" class="dropdown-item">
              Save
            </a>
            <a id="saveAsMenu" onclick="saveAs();" class="dropdown-item">
              Save a copy...
            </a>
            <a id="deleteMenu" onclick="showDeleteProgram();" class="dropdown-item">
              Delete from server
            </a>
          </div>
        </li>
        <li role="button" class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="downloadDD" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Download
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="downloadDD">
            <a id="downloadMenu" onclick="downloadJSON()" class="dropdown-item">
              Download JSON for website
            </a>
            <a id="downloadPDFMenu" onclick="showPDFDownload()" class="dropdown-item">
              Download PDF for printing
            </a>
          </div>
        </li>
        <li role="button" class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="importDD" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Import
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="importDD">
            <a id="importTalksMenu" onclick="showImportFSEorCHES(true)" class="dropdown-item">
              Import papers from TCHES or ToSC
            </a>
            <a id="uploadTalksMenu" onclick="showWebsubrevUpload(true)" class="dropdown-item">
              Upload papers in websubrev format
            </a>
            <a id="importDOIMenu" onclick="startImportDOIs()" class="dropdown-item">
              Import paper URLs
            </a>
          </div>
        </li>
        <li class="nav-item">
          <a target="_help" href="docs/help.html" class="nav-link">
            Help
          </a>
        </li>
        <li class="nav-item">
          <a target="_help" href="https://github.com/kaymckelly/program-editor" class="nav-link">
            About
          </a>
        </li>
        <li role="button" class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="loginDD" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <img src="img/md-person.svg">
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="loginDD">
            <!-- TODO: styling fix -->
            <span class="dropdown-item navbar-text" id="login_status">
              Login status unknown
            </span>
            <a id="loginMenu" onClick="$('#authModal').modal();this.blur()" class="dropdown-item">
              Log in
            </a>
            <a id="logoutMenu" onclick="doLogout()" class="dropdown-item">
              Log out
            </a>
          </div>
        </li>
      </ul>
    </nav>

    <div class="container-fluid">
      <div id="setupPrompts">
        <div class="row">
          <section class="col-md-12 setupStep instructions">
            <p class="text-justify">
              This app allows you to create a program for a conference. The things you need to
              get started are the dates of your conference and the list of accepted papers
              from websubrev (you could type those in again, but why bother?). The list of
              accepted papers is accessible as a JSON file from the program chair interface.
            </p>
          </section>
        </div>
        <!-- Button to trigger login modal -->
        <div class="row" id="auth-button">
          <div class="col-md-8">
            <button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#authModal">
              Log in for this app
            </button>
          </div>
        </div>
        <div class="row">
          <section id="newOrExisting" class="col-md-8 col-md-offset-2 setupStep">
            <p>
              If you've been here before, you can edit an existing program. Otherwise, start from a new one. If you open one that is owned by
              someone else, then you may not overwrite their work but you can save your own copy.
            </p>
            <div class="row">
              <div class="col-md-6">
                <button type="button" name="newProg" onclick="createNew();this.blur()" class="btn btn-success btn-sm">
                  New
                </button>
                <button type="button" name="existingProg" onclick="editExisting();this.blur()" class="btn btn-success btn-sm">
                  Existing
                </button>
              </div>
              <!-- <div class="col-md-6">
                <input class="form-control input-sm" type="text" placeholder="Search for a program (not yet working)">
              </div> -->
            </div>
          </section>
        </div>

        <div class="row">
          <section id="versionPicker" class="col-md-8 col-md-offset-2 setupStep">
            <table class="table table-bordered" id="versionList">
              <tr>
                <th>Name</th>
                <th>Owner</th>
                <th>Last modified</th>
<!--                <th><button type="button" class="btn btn-sm btn-disabled">Delete selected</button></th>-->
              </tr>
            </table>
          </section>
        </div>

        <div class="row">
          <section id="templateSelector" class="col-md-8 col-md-offset-2 setupStep">
            <select id="templateSelect" class="form-control input-sm" onchange="getConfig(this.value, false)">
              <option value="" disabled selected>
                Select a template to get started (you can change things later)
              </option>
              <option value="./json/crypto_config.json">
                Crypto (5 days, dual track, bbq)
              </option>
              <option value="./json/ec_config.json">
                Eurocrypt/Asiacrypt (5 days, dual track, banquet)
              </option>
              <option value="./json/pkc_config.json">
                CHES/FSE/PKC/TCC (4 days, single track)
              </option>
              <option value="./json/basic_1day.json">
                Basic one-day workshop
              </option>
              <option value="./json/basic_2day.json">
                Basic two-day workshop
              </option>
              <option value="./json/basic_3day.json">
                Basic three-day conference
              </option>
              <option value="./json/dualtrack_5day.json">
                Dual track, five days
              </option>
            </select>
          </section>
        </div>

        <div class="row" id="nameEntry">
          <section class="col-md-8 col-md-offset-2 setupStep">
            <p>
              Enter a name for the conference program.
            </p>
            <input type="text" name="inputName" id="inputName" />
            <button type="button" name="addName" onclick="addName()" class="btn btn-sm btn-success">
              Next
            </button>
          </section>
        </div>
        <div class="row">
          <section id="datePicker" class="col-md-8 col-md-offset-2 setupStep">
            <p>
              Choose the start and end date for your conference.
            </p>
            <label for="startdate">From
              <input type="text" id="startdate" name="startdate" />
            </label>
            <label for="enddate">to
              <input type="text" id="enddate" name="enddate" />
            </label>
          </section>
        </div>

        <div class="row">
          <section id="uploadTalks" class="col-md-8 col-md-offset-2 form-group">
            <p>
              Next, specify the list of accepted papers. This can be an upload from websubrev
              (a JSON file), or you can import accepted papers from TCHES or ToSC.
              You can do this later if you like.
            </p>
            <button type="button" name="showUpload" onclick="showWebsubrevUpload(false)" class="btn btn-sm btn-success">
              Upload websubrev accepted talks
            </button>
            <button type="button" name="showImport" onclick="showImportFSEorCHES(false)" class="btn btn-sm btn-success">
              Import from ToSC or TCHES
            </button>
            <button type="button" name="skipUpload" onclick="useEmptyTalks()" class="btn btn-sm btn-success">
              Skip for now
            </button>
            <button type="button" name="useDemoTalks" onclick="useDemoTalks()" class="btn btn-sm btn-success">
              Use demo data
            </button>
          </section>
        </div>
      </div>

      <main id="parent">
        <div class="row">
          <div class="col-md-12 my-3">
            <div id="alertInstr" class="alert alert-light alert-dismissible">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                Instructions: Drag talks from the left column to the sessions on the right. You can edit sessions, talks, timeslots, days, etc. Once you are satisfied with the program, you can export the JSON for the website. Remember that PDF doesn't work well on mobile.
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-3">
            <h3 class="text-center editorTitles">
              Unscheduled Talks
              <label data-toggle="tooltip" title="Add a talk" data-placement="top" data-trigger="hover" tabindex="0">
                <span class="addicon"><img src="img/add.svg" onclick="showTalkEditor('')"></span>
              </label>
            </h3>
          </div>
          <div class="col-md-9">
            <h3 class="text-center editorTitles">
              Schedule
              <label data-toggle="tooltip" title="Edit dates" data-placement="top" data-trigger="hover" tabindex="0">
                <span class="addicon"><img src="img/add.svg" onclick="showEditMetadata()"></span>
              </label>
            </h3>
          </div>
        </div>

        <!-- This is a handlebars partial that can be used in two places to display a talk. -->
        <script id="talk-partial" type="text/x-handlebars-template">
          <div class="talk" id="{{id}}">
            <a data-toggle="modal" data-target="editTalkBox" class="float-right" onclick="showTalkEditor('{{id}}')">
              <label data-toggle="tooltip" title="Edit the talk" data-placement="top" data-trigger="hover" tabindex="0">
                <span class="editIcon"><img src="img/edit.svg"></span>
              </label>
            </a>
            <h4 class="talkTitle">
              {{title}}{{#if paperUrl}}&nbsp;&nbsp;<a class="paperUrl" target="_paper" href="{{paperUrl}}"><span class="talkIcons"><img src="img/md-document.svg" title="View the paper"></span></a>{{/if}}
              {{#if slidesUrl}}&nbsp;&nbsp;<a class="paperUrl" target="_slides" href="{{slidesUrl}}"><span class="talkIcons"><img src="img/md-desktop.svg" title="View the slides"></span></a>{{/if}}
              {{#if starttime}}({{starttime}}{{#if endtime}}-{{endtime}}{{/if}}){{/if}}
            </h4>
            <div class="authorList">
              {{#each authors}}
                <span class="authorName">{{this}}</span>
              {{/each}}
            </div>
            {{#if volume}}
            <div class="volume">(Volume {{volume}})</div>
            {{/if}}
          </div>
        </script>
        <div class="row">
          <article id="categoryList" class="col-md-3">
            <section id="talksList">
              <!-- Handlebars script that renders the list of talks based on user-uploaded json file with websubrev output -->
              <script id="talks-template" type="text/x-handlebars-template">
                <!-- BUG: may have gray outline remaining after click b/c is button rather than anchor, as edit session pencil is -->
                {{#each unassigned_talks}}
                <div id="{{id}}">
                  <div class="categoryDiv">
                    <a data-toggle="modal" data-target="editCategoryBox" class="float-right" onclick="showCategoryEditor('{{id}}');">
                      <label data-toggle="tooltip" title="Edit the category" data-placement="bottom" data-trigger="hover" tabindex="0">
                        <span class="editIcon"><img src="img/edit.svg"></span>
                      </label>
                    </a>
                    <h3 class="categoryTitle">
                      {{name}}
                    </h3>
                  </div>
                  <section class="category" data-placeholder="Drag talks here to unschedule">
                    {{#each talks}}
                    {{> talk}}
                    {{/each}}
                  </section>
                </div>
                {{/each}}
              </script>
            </section>
            <label data-toggle="tooltip" title="Add a Category. These are not used in the program itself." data-placement="top" data-trigger="hover" tabindex="0" z-index="2" id="newCategoryButton">
              <span class="addicon"><img src="img/add.svg" onclick="showCategoryEditor('')"></span>
            </label>
          </article>
          <article id="renderedProgram" class="col-md-9">
            <!-- Handlebars script, renders editable program based on the user-selected program template -->
            <script id="program-template" type="text/x-handlebars-template">
              {{#each days}}
              <div class="row">
                <div class="col-md-5">
                  <hr />
                  <h3 class="pageSubtitle">
                    {{formatDate date}} <label data-toggle="tooltip" title="Add a time slot" data-placement="top" data-trigger="hover" tabindex="0">
                      <span class="addicon"><img src="img/add.svg" onclick="prepareAddTimeslotToDay({{@index}})"></span>
                    </label>
                  </h3>
                </div>
              </div>
              {{#each timeslots}}
              {{#if sessions}} <!-- only render slots that have sessions -->
              <div class="row">
                <div class="col-md-2 timeSlotDiv">
                    <a data-toggle="modal" data-target="editTimeslot" class="float-right" onclick="editTimeslot({{@../index}}, {{@index}})">
                      <label data-toggle="tooltip" title="Edit the time slot" data-placement="top" data-trigger="hover" tabindex="0">
                        <span class="editIcon"><img src="img/edit.svg"></span>
                      </label>
                    </a>
                  <br />
                  <p class="timeSlot text-center">
                    {{starttime}}-{{endtime}}
                  </p>
                </div>
                <div class="{{#if twosessions}}col-md-5{{else}}col-md-10{{/if}}">
                  <div class="{{#if twosessions}}track1Event{{else}}mutualEvent{{/if}} panel-body" id="{{sessions.0.id}}">
                    <a data-toggle="modal" data-target="editSessionBox" class="float-right" onclick="editSession({{@../index}},{{@index}},0)">
                      <label data-toggle="tooltip" title="Edit the session" data-placement="top" data-trigger="hover" tabindex="0">
                        <span class="editIcon"><img src="img/edit.svg"></span>
                      </label>
                    </a>
                    <h3 class="text-center">
                      {{sessions.0.session_title}}
                      {{#if sessions.0.session_url}}&nbsp;&nbsp;<a class="sessionUrl" target="_session" href="{{sessions.0.session_url}}"><img class="infoIcon" title="Additional information" src="img/info.svg"></a>{{/if}}
                    </h3>
                    {{#if sessions.0.location.name}}
                    <p class="text-center">
                      {{sessions.0.location.name}}
                    </p>
                    {{/if}}
                    {{#if sessions.0.moderator}}
                    <p class="text-center">
                      {{sessions.0.moderator}}
                    </p>
                    {{/if}}

                    {{#empty sessions.0.talks}}
                    {{#each sessions.0.talks}}
                    {{> talk}}
                    {{/each}}
                    {{/empty}}
                  </div>
                </div>
                {{#if twosessions}}
                <div class="col-md-5">
                  <div class="panel-body track2Event" id="{{sessions.1.id}}">
                    <a data-toggle="modal" data-target="editSessionBox" class="float-right" onclick="editSession({{@../index}},{{@index}},1)">
                      <label data-toggle="tooltip" title="Edit the session" data-placement="top" data-trigger="hover" tabindex="0">
                        <span class="editIcon"><img src="img/edit.svg"></span>
                      </label>
                    </a>
                    <h3 class="text-center">
                      {{sessions.1.session_title}}
                      {{#if sessions.1.session_url}}&nbsp;&nbsp;<a class="sessionUrl" target="_session" href="{{sessions.1.session_url}}"><img class="infoIcon" title="Additional information" src="img/info.svg"></a>{{/if}}
                    </h3>
                    {{#if sessions.1.location.name}}
                    <p class="text-center">
                      {{sessions.1.location.name}}
                    </p>
                    {{/if}}
                    {{#if sessions.1.moderator}}
                    <p class="text-center">
                      {{sessions.1.moderator}}
                    </p>
                    {{/if}}
                    {{#empty sessions.1.talks}}
                    {{#each sessions.1.talks}}
                    {{> talk}}
                    {{/each}}
                    {{/empty}}
                  </div>
                </div>
                {{/if}} <!-- end of second session -->
              </div>
              {{/if}} <!-- sessions -->
              {{/each}} <!-- timeslots -->
              {{/each}} <!-- days -->
            </script>
          </article>
        </div>
      </main>
    </div>

    <!-- Bootstrap scripts -->
    <script src="/libs/js/jquery/3.3.1/jquery.min.js"></script>
    <noscript><h1>This tool will not work without javascript.</h1></noscript>
    <script src="/libs/css/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Handlebars templates -->
    <script src="/libs/js/handlebars/handlebars-v4.1.0.js" type="text/javascript"></script>

    <!-- Dependencies (dragula, momentJS, jQuery daterangepicker, jQuery timepicker, & datepair) -->
    <script src="./dependencies/dragula/dragula.js"></script>
    <script src="/libs/js/moment/moment.min.js"></script>
    <script src="./dependencies/jquery-daterange-picker/jquery.daterangepicker.min.js"></script>
    <script src="./dependencies/jquery-timepicker/jquery.timepicker.min.js"></script>
    <script src="./dependencies/datepair/jquery.datepair.min.js"></script>

    <!-- Additional/custom scripts -->
    <script src="./scripts/editor.js?version=2"></script>

    <!-- modal to edit config metadata -->
    <aside class="modal fade" id="editMetadataModal" role="dialog" aria-labelledby="editMetadataTitle">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" id="editMetadataDiv">
            <h2 class="modal-title" id="editMetadataTitle">
              Edit conference name and dates
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p class="form-text">
              You can change the conference name and dates of the conference below.
            </p>
            <form class="form-inline">
              <div class="form-group">
                <label for="newName">
                  Program name
                </label>
                <input type="text" name="newName" placeholder="Program name (required)" class="form-control required" id="newName" required="true" />
              </div>
              <hr/>
              <div id="changeDatesDiv" class="form-group">
                <label for="newDates">
                  Dates for the conference
                </label><br/>
                <div class="panel panel-custom">
                  <div class="panel-heading panel-heading-custom">
                    Current dates
                  </div>
                  <div class="panel-body">
                    <span id="originalStartdate"></span> to
                    <span id="originalEnddate"></span>
                  </div>
                </div>
                <select id="dateChange" name="dateChange" class="form-control" onchange="updateNewDates()">
                  <option value="">No date change</option>
                  <option value="shift">Shift dates</option>
                  <option value="add">Add a day</option>
                  <option value="delete">Delete a day</option>
                </select>
                <label id="shiftDateControl" for="shiftDates">
                  Shift dates by <input size="4" type="number" id="shiftDates" value="0" onchange="updateNewDates()" oninput="updateNewDates()"> day(s)<br/>
                </label>
                <select id="addDayOption" name="addDayOption" class="required form-control" onchange="updateNewDates()">
                  <option value="" disabled>Choose before or after to add a day</option>
                  <option value="before">Before</option>
                  <option value="after">After</option>
                </select>
                <select id="deleteDayOption" name="deleteDayOption" class="required form-control" onchange="updateNewDates()">
                  <option value="" disabled>Choose first or last to delete</option>
                  <option value="first">Delete first day</option>
                  <option value="last">Delete last day</option>
                </select>
                  <br/><br/>
                <p class="alert alert-danger" id="deleteWarning">
                  If you delete a day, then all talks currently scheduled on that day will become unscheduled and any sessions will be lost.
                </p>
                <input id="newStartdate" name="newStartdate" type="hidden"/>
                <input id="newEnddate" name="newEnddate" type="hidden"/>
                <div class="panel panel-custom" id="newDates">
                  <div class="panel-heading panel-heading-custom">New dates:</div>
                  <div class="panel-body">
                    <span id="newDisplayStartdate"></span> to
                    <span id="newDisplayEnddate"></span>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light btn-sm" data-dismiss="modal">
              Cancel
            </button>
            <button type="button" class="btn btn-success btn-sm" onclick="saveMetadata()">
              Save program
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- delete program modal -->
    <div class="modal fade" id="deleteProgramModal" tabindex="-1" role="dialog" aria-labelledby="deleteProgramLabel">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h2 id="deleteProgramLabel" class="modal-title">Confirm Delete</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>You are about to delete this program from the server. This action cannot be reversed.</p>
            <p>Are you sure you want to delete it?</p>
          </div>
          <div class="modal-footer">
            <p id="delete_status"></p>
            <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" onclick="reallyDeleteProgram();">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal fade" id="authModal" tabindex="-1" role="dialog" aria-labelledby="authModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="authModalLabel">Log in for IACR Program Creator</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>This app requires you to log in with your IACR reference number
              and password.
            </p>
            <form class="form-horizontal" onsubmit="return false;">
              <div class="form-group">
                <label for="iacrref" class="col-sm-3 control-label">IACR ref #</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="iacrref">
                </div>
              </div>
              <div class="form-group">
                <label for="password" class="col-sm-3 control-label">Password</label>
                <div class="col-sm-8">
                  <input type="password" class="form-control" id="password">
                </div>
              </div>
            </form>
            <p>
              If you have forgotten your IACR reference number or password,
              <a target="_blank" href="https://secure.iacr.org/membership/members/update.html">click here to recover it</a>.
            </p>
          </div>
          <div class="modal-footer">
            <p id="login_progress"></p>
            <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
            <button type="button" onClick="doLogin();this.blur()"class="btn btn-success">Log in</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for import from crossref.org -->
    <aside class="modal fade" id="importDOISelection" role="dialog" aria-labelledby="importDOITitle">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" id="importDOIDiv">
            <h2 class="modal-title" id="importDOITitle">
              Import DOIs from crossref.org
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p class="form-text">
              This will attempt to import DOI URLs for the papers, but the matches are
              not guaranteed to be 100% accurate because they are not provided when the papers
              are uploaded.  You can always enter URLs individually,
              but this is very time-consuming. Note that if Springer
              has not finished processing the papers for this conference, then they
              will not be available yet. You can return later and update with links
              to the papers.
            </p>
            <div class="progress form-group">
              <div id="doiProgress" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div>
            </div>
          </div>
          <div class="modal-footer">
            <span id="doiStatus"></span>
            <button id="doiCloseBtn" type="button" class="btn btn-light btn-sm" data-dismiss="modal">Close</button>
            <button id="doiSearchBtn" type="button" onclick="findDOIs()" class="float-right btn btn-success btn-sm">Search</button>
          </div>
          <div class="form-group importResults" id="importResults">
            <ol id="resultList"></ol>
          </div>
        </div>
      </div>
    </aside>

    <!-- Modal for upload from websubrev -->
    <aside class="modal fade" id="uploadTalksModal" role="dialog" aria-labelledby="uploadTitle">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" id="uploadTitleDiv">
            <h2 class="modal-title" id="uploadTitle">
              Upload accepted talks from websubrev
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p class="form-text">
              Websubrev now allows program chairs to export a list of accepted talks. The format is described <a target="_help" href="./docs/help.html">here</a>.
            </p>
            <label for="uploadTalksSelector" class="btn btn-sm btn-success">
              <input type="file" accept=".json" id="uploadTalksSelector" />
              Upload JSON file
            </label>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success btn-sm" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Modal for import for FSE or CHES (from cryptodb) -->
    <aside class="modal fade" id="importTalksModal" role="dialog" aria-labelledby="importTitle">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="importTitle">
              Import talks from ToSC or TCHES.
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p class="form-text">
              Papers that have already been published by ToSC or TCHES may be imported below. A date range
              is optional.
            </p>
            <label for="uploadTalksSelector">
              <select class="form-control" id="importSelect">
                <option value="" selected disabled>Select a journal</option>
                <option value="tches">Transactions on Crypt. Hardware and Embedded Systems (TCHES)</option>
                <option value="tosc">Transactions on Symmetric Cryptography (ToSC)</option>
              </select>
              Select a date range of publication dates.<br>
              <label for="importstartdate">
                <input type="date" id="importstartdate" name="importstartdate" class="form-control" value="">
                Published after
              </label>
              <label for="importenddate">
                <input type="date" id="importenddate" name="importenddate" class="form-control" value="">
                Published before
              </label>
            </label>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light btn-sm" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-success btn-sm" onclick="importFSEorCHES()">Import papers</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Modal for warnings and errors -->
    <aside class="modal fade" id="errorBox" role="dialog" aria-labelledby="warningTitle">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" id="warnBoxTitle">
            <h2 class="modal-title" id="warningTitle">
              Warning
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p id="modal-message">
              Something's not quite right here.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success btn-sm" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Modal for adding, editing, or deleting a new talk. In case you are adding a talk,
         the delete button is not shown and the talkId field is empty.  -->
    <aside class="modal fade" id="editTalkBox" role="dialog" aria-labelledby="addTalkTitle">
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
          <div class="modal-header" id="addTalkTitleDiv">
            <h2 class="modal-title" id="addTalkTitle">
              Add a new talk
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="container-fluid">
              <form>
                <input id="talkId" type="hidden" value=""/>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label for="newTalkTitle">
                        Talk Title
                      </label>
                      <input type="text" name="newTalkTitle" placeholder="Talk title (required)" class="form-control required" id="newTalkTitle" required="true" />
                      <small class="form-text">
                        This should be the title of the original paper.
                      </small>
                    </div>
                    <div id="talkTitleWarning">
                      <div class="alert alert-danger">Talk title is required.</div>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="paperUrl">
                        URL for paper
                      </label>
                      <input type="url" name="paperUrl" placeholder="URL for paper" class="form-control" aria-describedby="paperUrlHelp" id="paperUrl" pattern="https?://.+"/>
                      <small class="form-text">
                        These can be imported automatically with the import menu. Do not use ePrint urls.
                      </small>
                    </div>
                    <div id="paperUrlWarning">
                      <div class="alert alert-danger">The url must begin with http or https.</div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label for="newTalkAuthors">
                        Talk Author(s)
                      </label>
                      <input type="text" name="newTalkAuthor" placeholder="Author names separated by and" class="form-control" aria-describedby="newAuthorHelp" id="newTalkAuthor" />
                      <small class="form-text">
                        Use BibTeX formatting (i.e. names are separated by and).
                      </small>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="slidesUrl">
                        URL for slides
                      </label>
                      <input type="url" name="slidesUrl" placeholder="URL for slides" class="form-control" aria-describedby="slidesUrlHelp" id="slidesUrl" pattern="https?://.+"/>
                    </div>
                    <div id="slidesUrlWarning">
                      <div class="alert alert-danger">The url must begin with http or https.</div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label for="newTalkAffiliation">
                        Affiliation
                      </label>
                      <input type="text" name="newTalkAffiliation" placeholder="Author affiliation(s)" class="form-control" aria-describedby="newAffiliationHelp" id="newTalkAffiliation" />
                      <small class="form-text">
                        Enter affiliations for authors, separated by semicolon. If authors share an affiliation, there is no need to enter the same institution twice.
                      </small>
                    </div>
                  </div>
                  <div class="col">
                    <!-- TODO: set up url for video field -->
                    <!-- <div class="form-group">
                      <label for="videoUrl">
                        URL for video
                      </label>
                      <input type="url" name="videoUrl" placeholder="URL for video" class="form-control" aria-describedby="videoUrlHelp" id="videoUrl" pattern="https?://.+"/>
                    </div>
                    <div id="videoUrlWarning">
                      <div class="alert alert-danger">The url must begin with http or https.</div>
                    </div> -->
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label for="newTalkCategory">
                        Talk Category
                      </label>
                      <select id="newTalkCategory" class="form-control">
                        <option value=""></option>
                      </select>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group mb-0">
                      <label for="startTime">
                        Start time
                      </label>
                      to
                      <label for="endTime">
                        End time
                      </label> (Optional)
                    </div>
                    <div class="form-group form-inline" id="talkTimeDiv">
                      <input type="text" name="startTime" class="form-control time start mr-2" id="currentTalkStartTime" autocomplete="off" />
                      to
                      <input type="text" name="endTime" class="form-control time end ml-2" id="currentTalkEndTime" autocomplete="off" />
                      <small class="form-text">
                        Note that these are not checked to fit the timeslot.
                      </small>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div id="deleteTalkWarning" class="modal-body">
            <div class="alert alert-danger">If you delete this talk, then you cannot recover the data. It will be permanently removed from the app.</div>
          </div>
          <div class="modal-footer">
            <button id="talkDeleteButton" type="button" class="btn btn-danger btn-sm float-left" onclick="deleteTalk()">
              Delete talk completely
            </button>
            <button type="button" class="btn btn-light btn-sm" data-dismiss="modal">
              Cancel
            </button>
            <button type="button" class="btn btn-success btn-sm" onclick="saveTalk()">
              Save Talk
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Modal for adding or editing a category. In case you are adding a category,
         the delete button is not shown and the categoryId field is empty.  -->
    <aside class="modal fade" id="editCategoryBox" role="dialog" aria-labelledby="categoryEditorTitle">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" id="addCategoryTitleDiv">
            <h2 class="modal-title" id="categoryEditorTitle">
              Add a category
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <input id="categoryId" type="hidden" value=""/>
              <div class="form-group">
                <label for="newCategoryName">
                  Category name
                </label>
                <input type="text" name="newCategoryName" placeholder="Category name (required)" class="form-control required" id="newCategoryName" required="true" />
              </div>
            </form>
          </div>
          <div id="deleteCategoryWarning" class="modal-body">
            <div class="alert alert-danger">If you delete this category, then the talks in this category become uncategorized.</div>
          </div>
          <div class="modal-footer">
            <button id="deleteCategoryButton" type="button" class="btn btn-danger btn-sm float-left" onclick="deleteCategory()">
              Delete category
            </button>
            <button type="button" class="btn btn-light btn-sm" data-dismiss="modal">
              Cancel
            </button>
            <button type="button" class="btn btn-success btn-sm" onclick="saveCategory()">
              Update category
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Modal for editing a timeslot -->
    <aside class="modal fade" id="editTimeslot" role="dialog" aria-labelledby="timeEditTitle">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" id="timeEditTitleDiv">
            <h2 class="modal-title" id="timeEditTitle">
              Edit Time Slot
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <!-- NOTE: used only for saving edited time slot to progData -->
              <input type="hidden" id="timeslotDayIndex" value="" />
              <input type="hidden" id="timeslotIndex" value="" />
              <div class="form-inline">
                <div class="form-group">
                  <label for="startTime">
                    Start time
                  </label>
                  to
                  <label for="endTime">
                    End time
                  </label>
                </div>
                <div class="form-group" id="timeDiv">
                  <input type="text" name="startTime" class="form-control time start" id="currentStartTime" autocomplete="off" />
                  to
                  <input type="text" name="endTime" class="form-control time end" id="currentEndTime" autocomplete="off" />
                </div>
                <div id="addTrackToSession">
                  <br />
                  <br />
                  <p class="form-text">
                    To split this session into two tracks, please check the box below.
                  </p>
                  <label for="numsessions">Add a track to this timeslot?</label>
                  <input type="checkbox" name="numsessions" id="makeDualSession"></input>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-body" id="deleteTimeslotWarning">
            <div class="alert alert-danger">If you delete this timeslot, then any talks in the session will become unscheduled.</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light btn-sm" data-dismiss="modal">
              Cancel
            </button>
            <button id="deleteTimeslotButton" type="button" class="btn btn-danger btn-sm float-left" onclick="deleteTimeslot()">
              Delete Time Slot
            </button>
            <button type="button" class="btn btn-success btn-sm" data-dismiss="modal" onclick="saveTimeslot()">
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Modal for editing a session -->
    <aside class="modal fade" id="editSessionBox" role="dialog" aria-labelledby="editSessionTitle">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" id="editSessionTitleDiv">
            <h2 class="modal-title" id="editSessionTitle">
              Edit Session
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <!-- NOTE: These are used to look up the session that is being edited. -->
              <input type="hidden" id="currentDayIndex" value="" />
              <input type="hidden" id="currentSlotIndex" value="" />
              <input type="hidden" id="currentSessionIndex" value="" />
              <div class="form-group">
                <label for="sessionTitle">
                  Session Title
                </label>
                <input type="text" name="sessionTitle" placeholder="Session title" class="form-control required" id="currentSessionTitle" required="true"/>
              </div>
              <div class="form-group">
                <label for="currentSessionURL">
                  Information URL
                </label>
                <input type="url" name="currentSessionURL" placeholder="Optional URL for session information" class="form-control" id="currentSessionURL"/>
              </div>
              <div class="form-group">
                <label for="currentSessionLocation">
                  Location
                </label>
                <input type="text" name="currentSessionLocation" placeholder="Optional session location" class="form-control" id="currentSessionLocation" />
              </div>
              <div class="form-group">
                <label for="currentSessionModerator">
                  Moderator
                </label>
                <input type="text" name="currentSessionModerator" placeholder="Optional session moderator (e.g. 'Chair: Alan Turing')" class="form-control" id="currentSessionModerator" />
              </div>
              <div class="form-group">
                <label class="checkbox-inline" for="allowTalks">
                  <input type="checkbox" name="allowTalks" id="allowTalks"> Allow talks in this session
                </label>
              </div>
            </form>
          </div>
          <div class="modal-body" id="deleteSessionWarning">
            <div class="alert alert-danger">If you delete this session, then any talks in the session will become unscheduled.</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light btn-sm" data-dismiss="modal">
              Cancel
            </button>
            <button id="deleteSessionButton" type="button" class="btn btn-danger btn-sm float-left" onclick="deleteSession()">
              Delete Session
            </button>
            <button type="button" class="btn btn-success btn-sm" data-dismiss="modal" onclick="saveSession()">
              Save Session
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Modal for adding a timeslot (creates a blank session(s)) -->
    <aside class="modal fade" id="addTimeslot" role="dialog" aria-labelledby="addTimeslotTitle">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" id="addTimeslotDiv">
            <h2 class="modal-title" id="addTimeslotTitle">
              Add a Time Slot
            </h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p class="form-text">
              Timeslots are ordered by their start time but may overlap.
            </p>
            <br />
            <form>
              <input type="hidden" id="dayIndex" value="" />
              <div class="form-inline">
                <div class="form-group">
                  <label for="startTime">
                    Start time
                  </label>
                  to
                  <label for="endTime">
                    End time
                  </label>
                </div>
                <div class="form-group" id="timeslotDiv">
                  <input type="text" name="startTime" class="form-control time start" id="newStartTime" autocomplete="off" pattern="^[0-2]?[0-9]:[0-9]{2}$" required="true"/>
                  to
                  <input type="text" name="endTime" class="form-control time end" id="newEndTime" autocomplete="off" pattern="^[0-2]?[0-9]:[0-9]{2}$" required="true"/>
                </div>
                <br />
                <div class="form-group" id="timeSlotWarning">
                  <br/><div class="alert alert-warning">Start and end time are required.</div>
                </div>
                <br />
                <label for="numtracks">Select the number of tracks.</label>
                <select name="numtracks" id="selectSessionCount">
                  <option value="1">One track</option>
                  <option value="2">Two tracks</option>
                </select><br/>
                <label for="includeTalks">Allow talks in the timeslot:</label>
                <input type="checkbox" name="includeTalks" id="includeTalks"></input>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light btn-sm" data-dismiss="modal">
              Cancel
            </button>
            <button type="button" class="btn btn-success btn-sm" onclick="addTimeslotToDay()">
              Add time slot
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- modal to download PDF -->
    <div class="modal fade" id="downloadPDFModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">Download PDF</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>The PDF file will be opened in a separate tab.</p>
            <p>Note that formatting on paper is a work in progress, and may not be very usable
              at this time.</p>
            <form id="pdfform" method="POST" action="pdf/program.php" target="_programpdf" class="form-inline">
              <input type="hidden" name="json" value="">
              <div class="form-group">
                <label for="page_format">
                  Page format:
                </label>
                <select name="page_format" id="page_format" class="form-control">
                  <option value="Letter">US Letter</option>
                  <option value="Letter-L">US Letter landscape</option>
                  <option value="A4">A4</option>
                  <option value="A4-L">A4 landscape</option>
                  <option value="A0">A0 for posters (841mm x 1189mm)</option>
                  <option value="A1">A1 for posters (594mm x 841mm)</option>
                  <option value="A2">A2 for posters (594mm x 841mm)</option>
                  <option value="A3">A3 for posters (297mm x 420mm)</option>
                  <option value="Legal">US Legal</option>
                  <option value="Tabloid">US Tabloid for posters (11.0 x 17.0 in)</option>
                  <option value="HTML">Crude HTML for printing (not for web use)</option>
                </select>
              </div>
              <div class="form-group">
                <label for="two_column">
                  Two column format:
                </label>
                <input name="two_column" id="two_column" type="checkbox" class="form-control">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
            <a class="btn btn-success btn-ok" onclick="downloadPDF();">Download PDF</a>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>
